[TOC]

# Key point

## 二、计算机系统概述

#### 存储程序工作方式的基本思想

程序和数据预先存放在存储器中，机器工作时，自动、逐条地从存储器中读出指令并执行。

#### 计算机的硬件由哪些部件组成？

**组成**：**运算器（中心（冯诺依曼））、控制器、存储器、I/O设备**

​			存储器 =  主存 + 辅存

​			CPU = 运算器 + 控制器	**CPU只直接访问主存**

​			主机 = CPU + 主存

#### 计算机硬件连接方式

计算机硬件各个部分都通过**总线**互连

#### 程序执行过程

是一个循环的指令执行过程，循环变量为指令地址

指令执行过程分为：取指令、分析指令、执行指令

寄存器PC用于存放指令地址

寄存器IR存放当前指令内容

**取指令阶段**用PC的内容作为地址从主存中读出指令，存到IR中

**分析指令阶段**用ID（指令译码器）分析出IR中内容包含的操作类型、操作数信息

**执行指令阶段**根据指令分析的结果实现相应操作

#### 性能指标计算

- T相应 = Tcpu + T等待

- Tcpu = In * CPI * Tc 

  In 指令个数	CPI每条指令的平均执行时间	T每个周期的时间（1/f）

- Tp（吞吐率）指令个数和 / 所有任务的CPU时间

$$
Tp = ΣIn(任务i)/ Tcpu（所有任务）
$$

## 三、数据的表示和运算

- **数0的原码有两个，而补码唯一**

- [X]补-[-X]补：[X]补的所有位取反，末位加1

- 反码
  - 若X为正数，X反码 = X补码
  - 若X为负数，X反码 = X补码 - 1 / X补码 = X反码 + 1
  
- 移码
  
  - 移码符号位 = 补码符号位取反	移码数值位 = 补码数值位
  
- 浮点数**表示：0.XXXXX * 2^(XXX)**

  注意：数值部分（小数）的扩展是在尾部

- 规格化：看数值部分0.5≤|*M*|＜1不用规格化

  （第一位是符号位，不比较）

  [*M*]原＝**1**110010110，0.5≤|*M*|＜1，不用规格化

  [*M*]原＝**1**010010110，0＜|*M*|＜0.5，需左规1次

  [*M*]补＝1110010110，0＜|*M*|＜0.5，需左规2次

  （补码的规格化：化为原码看 / 规格化到符号位和第一个数值位相反）

- IEEE 754 标准

  **表示：1.XXXXX * 2^(XXX)**

  所以，尾数代表的若是0111....，则实际应该是**1.**0111.....* 2(...)

  32位：数符（1位）+阶（8位）+尾数（32-1-8=23位）

  64位：数符（1位）+阶（11位）+尾数（64-1-11=52位）

  实际转为编码：127+阶（不管正负号） = (编码)10

  编码转为实际：(编码)10 - 127 = 阶

- 无符号加减运算的溢出判断 OF = Cn-1异或 C-1

  加法：C-1 = 0	减法：C-1 = 1

- 定点乘法运算：

  从乘数（乘号后面的数）的低位开始看，是1则加上被乘数，是0则加上0...0

  对结果要扩展位数，总位数 = 被乘数位数 * 乘数位数（小数从后面扩展）

## 四、存储系统

- RAM芯片为什么采用双译码方式？

  将所有存储元组织成二维矩阵形式，可以是存储元间连线长度最短，线路延迟最小，从而提高性能降低成本。

- 为什么设置片选引脚？

  RAM芯片规格有限，需允许用户利用已有芯片二次设计，满足用户需求。故要求设置CS实现芯片操作控制。

- 读操作、写操作时序的不同？

  都是先发送地址信号，后使CS有效、发送操作命令。接收/读取完毕后才使CS无效。

  读操作在操作结束前接收数据，而写操作在操作开始时发送数据。

#### 引脚组织

芯片容量 S = 存储单元长度w * 存储单元数量2^n

SRAM：

数据引脚：单向（2w），双向（w）

地址引脚：单向（n = ㏒2(S/w) ）

片选：CS非/CS 其中一种

读写引脚：WE非

DRAM：

数据引脚：同SRAM

地址引脚：n/2	（地址分两次接受（行地址、列地址））

控制引脚：行地址选通RAS非，列地址选通CAS非，读/写 WE非

- DRAM为何设置RAS非，CAS非引脚，没有CS非引脚？

  为了保持高级程度，DRAM芯片的地址分两次传送，故需要上述两个信号区分当前地址信号是行地址还是列地址。

  **使RAS非信号在整个过程中都有效，就可以实现片选引脚功能**

#### 主存与CPU的连接

WR非要连接WE非⭐

WR非、RD非——异或

#### MEM的带宽

$$
Bm = W / Tm	（W为数据宽度，即数据引脚w个数）
$$

- 多体交叉存储器
  1. 交叉访问方式：W' = W'， Tm' = 1/m * Tm
  2. 并行工作方式：W' = m*W，Tm' = Tm

> 某4K×8位SRAM芯片的存储周期为200ns，该芯片的带宽是多少？由4个上述芯片构成的16K×8位多体交叉存储器，若采用交叉访问方式，则访问64个字节最少需要多少个存储周期？启动各存储体轮流工作的时钟频率是多少？
>
> SRAM芯片的带宽为：8bit/(200×10-9s)＝4×107bit/s＝40Mbps。
>
> 4个交叉存储器采用交叉访问方式工作时，各存储体轮流启动的间隔为200ns/4＝50ns，访问64个字节最少需要200ns＋(64－1)×50ns＝3350ns＝3.35μs。
>
> 启动各存储体轮流工作的时钟频率为：1/(200ns/4)＝2×107Hz＝20MHz。

#### Cache的地址映射

##### 1）直接映射

块调入时冲突率最高，地址变换速度最快，成本最低

主存地址：区号、区内块号、块内地址	（区号 + 区内块号 = 主存块号）

Cache地址：		行号、		块内地址

- 区内块号 = 行号
- 索引：区内块号        标记tag：区号

##### 2）全相联映射

块调入时冲突率最低，地址变换速度较快，成本最高

主存地址：主存块号、块内地址

Cache地址：     行号、块内地址

- 没有索引                    标记tag：主存块号

##### 3）组相联映射

块调入时冲突率较低，地址变换速度较快，成本较低

主存地址：群号、群内块号、块内地址

Cache地址：         组号、组内行号、块内地址

- 群内块号 = 组号
- 索引：群内块号        标记tag：群号

⭐使用组相联映射的**Cache行管理位**：有效位（1）、标记位tag（？）、LRU（Cache组内行号位）（使用LRU替换算法才有）、脏位（1）（采用写回法写策略才有）

## 五、指令系统

- 指令字长、机器字长、存储字长三者间有何关系?

  机器字长，一次整数运算所能处理的**二进制数据的位数**，也就是运算器进行定点数运算的字长，通常也是**CPU内部数据通道的宽度**。

  存储字长，存储单元中的二进制代码（*存储*字）位数，可以是8位、16位、32位等

  > **机器字长＝n×存储字长**，整数n≥1且为**常数**。解析：由于机器字长为CPU一次能处理数据的最大位数，故机器字长为常数；由于数据可存放在MEM中，故机器字长为存储字长的倍数；由于数据可表示为多种长度，为了节省其所占存储空间，存储字长通常为最短数据的长度，即n≥1。
  >
  > 
  >
  > **指令字长＝m×存储字长**，整数m≥1，**指令字长与机器字长没有关系**。解析：由于指令存放在MEM中，故指令字长为存储字长的倍数；由于指令系统有定长指令字、变长指令字2种结构，故**m不一定为常数**。

- 只有？基址寻址、变址寻址用的是无符号数

## 六、中央处理器

- 一个区别

  > 程序执行的机制：取指令--分析指令--执行指令
  >
  > 指令执行过程的步骤：取指令、指令译码、取操作数、保存结果、计算指令地址
  >
  > ​										**取指令、指令译码对任何指令都适用**
  >
  > ​										**计算指令地址**步骤通常与其他5个步骤重叠，以缩短指令周期

- CPU基本操作：寄存器间数据传送、存储器读、存储器写、算逻运算

- 计算吞吐率、加速比、效率

  > 若指令执行过程分为取指、译码、取数、执行、写结果5个阶段，各个阶段的操作时延分别为10ns、5ns、10ns、8ns、7ns。将数据通路组织成流水线时，段间寄存器的时延为2ns。请回答下列问题：
  >
  > （1）若采用串行方式执行10000条指令，共需要多少时间？
  >
  > （2）流水线的拍长应为多少？
  >
  > （3）若采用流水方式执行10000指令，流水线的吞吐率、加速比、效率各是多少？
  >
  > 答：（1）每条指令的指令周期为10ns＋5ns＋10ns＋8ns＋7ns＝40ns，执行10000条指令所需时间*T*串行＝10000×40ns＝0.4ms。
  >
  > （2）**流水线的拍长Δ*t*＝max{10ns, 5ns, 10ns, 8ns, 7ns}＋2ns＝12ns**。
  >
  > （3）*T*流水＝5Δ*t+*(10000－1)Δ*t*＝10004×12ns，
  >
  > 流水线的吞吐率*T**p*＝10000/*T*流水＝10000/(10004×12ns)＝83.3 MIPS，
  >
  > 流水线的加速比*S*＝*T*串行/*T*流水＝0.4ms/(10004×12ns)＝3.33，
  >
  > 流水线的效率
  >
  > E＝[ (10000 × 5 × 12ns) /5 ] / ( 10004 × 12ns ) ≈ 1

## 七、总线

- 寻址空间决定地址总线宽度

- 一个总线周期的阶段：申请及分配阶段、寻址阶段、传送数据阶段、结束阶段

  申请及分配阶段只有主设备参与

## 八、输入输出系统

- 外设识别自身是否为**总线事务的目标从设备**的方法

  每个外设独有唯一的设备号，保存在所连接的I/O接口中。I/O接口一直监视总线状态，当有I/O总线事务时，将所存设备号与总线上地址进行比较，从而识别出自身是否为总线事务的目标从设备。

- 磁盘地址 = 磁道号 + 盘面号（不算没有数据记录的盘面） + 扇区号

- 可屏蔽中断请求得到响应的条件为：♥

  1）外设要提出中断请求

  2）IF位设置为可供响应（IF = 1）

  3）当多个或当前指令周期结束时

  4）无DMA请求（无更紧急的中断请求）

- 中断响应需要完成的任务有

  ①保存断点及程序状态

  ②关中断

  ③识别事件类型并转入处理程序

  向量中断方式下，识别事件类型并转入处理程序包含的子任务有：识别中断源、获得处理程序入口地址、将处理程序入口地址写入PC。

  识别中断源需通过CPU外部的中断响应操作来实现，获得处理程序入口地址需通过查询放在主存中的IVT实现。

> \17. 某计算机的主频为200MHz、CPI为5，设备A的数据传输率为32Kbps、每次I/O可传送32位数据。程序查询方式中，一次I/O的查询平均需要49个指令周期；程序中断方式中，中断响应需要15个时钟周期，中断服务程序有10条指令。
>
> （1）程序查询方式中，CPU用于I/O的时间占CPU总时间的百分比是多少？
>
> （2）程序中断方式中，CPU用于I/O的时间占CPU总时间的百分比又是多少？
>
> 答：依题意，CPU主时钟周期为1÷200MHz＝5ns，设备A每次传送32位数据，每秒可传送32Kbps÷32b＝1000次，每次传送需要1÷1000＝1ms。
>
> （1）轮询方式中，一次I/O所需的CPU时间为(49＋1)×5×5ns＝1.25μs，CPU用于I/O的时间占CPU总时间的百分比1.25μs÷1ms＝0.125%。
>
> （2）中断方式中，一次I/O所需的CPU时间为(15＋10×5)×5ns＝0.325μs，CPU用于I/O的时间占CPU总时间的百分比0.325μs÷1ms＝0.0325%。